language: rust
cache: cargo

matrix:
  include:
    - rust: stable
      script:
        - rustup component add rustfmt
        - cargo fmt --all -- --check
        - cargo build --verbose --all
        - cargo test --verbose --all

      deploy:
        - provider: script
          script: cargo publish --token ${CRATES_IO_TOKEN} --manifest-path cmdr_macro/Cargo.toml

          on:
            tags: true
            branch: master

        - provider: script
          script: cargo publish --token ${CRATES_IO_TOKEN} --manifest-path cmdr/Cargo.toml

          on:
            tags: true
            branch: master

    - rust: beta
      script:
        - rustup component add rustfmt
        - cargo fmt --all -- --check
        - cargo build --verbose --all
        - cargo test --verbose --all

    - rust: nightly
      script:
        - rustup component add rustfmt
        - cargo fmt --all -- --check
        - cargo build --verbose --all
        - cargo test --verbose --all

